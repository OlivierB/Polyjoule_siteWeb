<!--/**********Page de gestion du profil**********/--><?php $actions = array(1,2,3,4,5,6); // Tableau des actions possibles/*	Action 1 : modifier pseudo	Action 2 : modifier mot de passe	Action 3 : modifier email	Action 4 : Traitement modification pseudo	Action 5 : Traitement modification mot de passe	Action 6 : traitement modification email	Default : Affichage du profil*//*	default : affichage du contenu du message*/if(isset($_GET['action']) && in_array($_GET['action'],$actions)){	$action = $_GET['action'];	if ($action==1) { //modifier pseudo		?>			<div class="contenu" style="text-align:center;">				<div style="height:50px;">					<div style="float : left;font-size : 120%;font-weight:bold;">						<div style="float:right; margin-top:10px;margin-left:10px;">							Modification du pseudo						</div>					</div>					<div style="height:50px;width:300px;float:right;">						<a href="" class="save"><img src="ressources/design/style1/images/save.png" alt="save_profil">Sauver</a>						<a href="" class="validate"><img src="ressources/design/style1/images/validate.png" alt="apply_profil">Appliquer</a>						<a href="index.php?page=rubrique&message=procedureAnnulee" class="cancel"><img src="ressources/design/style1/images/cancel.png" alt="cancel_profil">Annuler</a>					</div>				</div>				<div style="background-color : #f0f0ee;margin : 10px 12px 20px 13px;border : 1px solid #cccccc;text-align:left; padding-left : 20px;">					<strong>Information</strong> : Vous serez déconnecté une fois la procédure achevée si tout s'est bien passé.				</div>				<div style="background-color : #f0f0ee;margin : 10px 12px 20px 13px;border : 1px solid #cccccc;text-align:left; padding-left : 20px;">					<form method="post" action="<?php echo $pageProfil."&action=4" ?>">						<p>							<label for="pseudo" style="float : left;"><strong>Pseudo</strong> :</label>							<input type="text" style="margin-left:10px;" size="20" value="<?php echo $_SESSION['pseudo_membre']; ?>" name="pseudo"/> <br/><br/>						</p>						<input type="submit" value="Envoyer !" />					</form>				</div>			</div>		<?php	} else if ($action==2) { //modifier mot de passe		?>			<div class="contenu" style="text-align:center;">				<div style="height:50px;">					<div style="float : left;font-size : 120%;font-weight:bold;">						<div style="float:right; margin-top:10px;margin-left:10px;">							Modification du mot de passe						</div>					</div>					<div style="height:50px;width:300px;float:right;">						<a href="" class="save"><img src="ressources/design/style1/images/save.png" alt="save_profil">Sauver</a>						<a href="" class="validate"><img src="ressources/design/style1/images/validate.png" alt="apply_profil">Appliquer</a>						<a href="index.php?page=rubrique&message=procedureAnnulee" class="cancel"><img src="ressources/design/style1/images/cancel.png" alt="cancel_profil">Annuler</a>					</div>				</div>				<div style="background-color : #f0f0ee;margin : 10px 12px 20px 13px;border : 1px solid #cccccc;text-align:left; padding-left : 20px;">					<strong>Information</strong> : Vous serez déconnecté une fois la procédure achevée si tout s'est bien passé.				</div>				<div style="background-color : #f0f0ee;margin : 10px 12px 20px 13px;border : 1px solid #cccccc;text-align:left; padding-left : 20px;">					<form method="post" action="<?php echo $pageProfil."&action=5" ?>">						<p>							<table>								<tr>									<td>										<label for="ancien" style="float : left;"><strong>Ancien mot de passe</strong> :</label>									</td>									<td>										<input type="password" style="margin-left:10px;" size="20" value="" name="ancien"/>									</td>								</tr>								<tr>									<td>										<label for="mdp" style="float : left;"><strong>Mot de passe</strong> :</label>									</td>									<td>										<input type="password" style="margin-left:10px;" size="20" value="" name="mdp"/>									</td>								</tr>								<tr>									<td>										<label for="mdp2" style="float : left;"><strong>Mot de passe</strong> (confirmation) :</label>									</td>									<td>										<input type="password" style="margin-left:10px;" size="20" value="" name="mdp2"/>									</td>								</tr>							</table>						</p>						<input type="submit" value="Envoyer !" />					</form>				</div>			</div>		<?php	} else if ($action==3) { //modifier email		?>			<div class="contenu" style="text-align:center;">				<div style="height:50px;">					<div style="float : left;font-size : 120%;font-weight:bold;">						<div style="float:right; margin-top:10px;margin-left:10px;">							Modification de l'adresse mail						</div>					</div>					<div style="height:50px;width:300px;float:right;">						<a href="" class="save"><img src="ressources/design/style1/images/save.png" alt="save_profil">Sauver</a>						<a href="" class="validate"><img src="ressources/design/style1/images/validate.png" alt="apply_profil">Appliquer</a>						<a href="index.php?page=rubrique&message=procedureAnnulee" class="cancel"><img src="ressources/design/style1/images/cancel.png" alt="cancel_profil">Annuler</a>					</div>				</div>				<div style="background-color : #f0f0ee;margin : 10px 12px 20px 13px;border : 1px solid #cccccc;text-align:left; padding-left : 20px;">					<form method="post" action="<?php echo $pageProfil."&action=6" ?>">						<p>							<table>								<tr>									<td>										<label for="mail" style="float : left;"><strong>Nouvel E-mail</strong> :</label>									</td>									<td>										<input type="email" style="margin-left:10px;" size="20" value="" name="mail"/>									</td>								</tr>								<tr>									<td>										<label for="mail2" style="float : left;"><strong>Nouvel E-mail</strong> (confirmation) :</label>									</td>									<td>										<input type="email" style="margin-left:10px;" size="20" value="" name="mail2"/>									</td>								</tr>							</table>						</p>						<input type="submit" value="Envoyer !" />					</form>				</div>			</div>		<?php	} else if ($action==4) { //Traitement modification pseudo		if (isset($_POST['pseudo'])) {			$pseudo=mysql_real_escape_string($_POST['pseudo']);			if ($pseudo!="") {				if ($_SESSION['pseudo_membre']=="admin") {					header("Location: $pageProfil&message=changementPseudoImpossibleAdmin");				} else {					if ($pseudo=="admin") {						header("Location: $pageProfil&message=pseudoImpossibleAdmin");					} else {						//vérification de non existence du pseudo						$req="UPDATE MEMBRE SET pseudo_membre='".$pseudo."' WHERE id_membre=".$_SESSION['id_membre'].";";						mysql_query($req) or die(mysql_error());						header("Location: $pageDeconnexion");					}				}			} else {				header("Location: $pageProfil&message=erreurFormulaire");			}		} else {			header("Location: $pageProfil&message=erreurFormulaire");		}	} else if ($action==5) { //Traitement modification mot de passe		if (isset($_POST['ancien']) && isset($_POST['mdp']) && isset($_POST['mdp2'])) {			$ancien=sha1(mysql_real_escape_string($_POST['ancien']));			$mdp=sha1(mysql_real_escape_string($_POST['mdp']));			$mdp2=sha1(mysql_real_escape_string($_POST['mdp2']));			$req=mysql_query("SELECT * FROM MEMBRE WHERE id_membre=".$_SESSION['id_membre'].";");			$profil=mysql_fetch_array($req);			if ($profil[2]==$ancien) {				if ($mdp==$mdp2) {					$req2="UPDATE MEMBRE SET mdp_membre='".$mdp."' WHERE id_membre=".$_SESSION['id_membre'].";";					mysql_query($req2) or die(mysql_error());					header("Location: $pageDeconnexion");				} else {					header("Location: $pageProfil&message=motDePasseDifferent");				}			} else {				header("Location: $pageProfil&message=mauvaisAncienMotDePasse");			}		} else {			header("Location: $pageProfil&message=erreurFormulaire");		}	} else if ($action==6) { //traitement modification email		if (isset($_POST['mail']) && isset($_POST['mail2'])) {			$mail=mysql_real_escape_string($_POST['mail']);			$mail2=mysql_real_escape_string($_POST['mail2']);			if ($mail==$mail2) {				//mail conforme				$req="UPDATE MEMBRE SET mail_membre='".$mail."' WHERE id_membre=".$_SESSION['id_membre'].";";				mysql_query($req) or die(mysql_error());				header("Location: $pageProfil&message=mailOk");			} else {				header("Location: $pageProfil&message=mailDifferent");			}		} else {			header("Location: $pageProfil&message=erreurFormulaire");		}	} else { //affichage du profil		header("Location: $pageProfil");	}} else {	?>		<div class="contenu" style="text-align:center;">			<h2>Gestion du profil</h2>	<?php	if (isset($_GET['message'])) {		?>			<div style="background-color : #f0f0ee;margin : 10px 12px 20px 13px;border : 1px solid #cccccc;text-align:left; padding-left : 20px;">				<strong>Message :</strong>		<?php		$msg=$_GET['message'];		if ($msg=="erreurFormulaire") {			echo "Il y a une erreur dans le formulaire. Veuillez recommencez.";		}/* else if ($msg=="") {			echo "";		}*/ else {			echo $_GET['message'];		}		?>			</div>		<?php	}	?>			<!--Contenu-->			<div style="background-color : #f0f0ee;margin : 10px 12px 20px 13px;border : 1px solid #cccccc;text-align:left; padding-left : 20px;">			<strong>Pseudo :</strong>			<?php				$req = mysql_query("SELECT * FROM MEMBRE WHERE id_membre=".$_SESSION['id_membre'].";");				$profil=mysql_fetch_array($req) or die(mysql_error());				//affichage du pseudo				?>					<input type="text" style="margin-left:10px;" size="20" value="<?php echo $profil[1]; ?>" name="pseudo" readonly="readonly"/>				<?php				//lien de modification du pseudo				if ($profil[1]=="admin") {//Si c'est l'admin					?>						<div style="background-color : #f0f0ee;margin : 10px 12px 20px 13px;border : 1px solid #cccccc;text-align:left; padding-left : 20px;">							Changement de pseudo impossible pour l'administrateur.						</div>					<?php				} else {//Si ce n'est pas l'admin					echo "<a href='index.php?page=profil&action=1'>Changement du pseudo</a>";					echo "<br />";				}			?>			<?php				//lien de changement de mot de passe				echo "<a href='index.php?page=profil&action=2'>Changement du mot de passe</a>";				echo "<br />";echo "<br />";			?>			<strong>Mail :</strong>			<?php				?>					<!--affichage du mail-->					<input type="email" style="margin-left:10px;" size="20" value="<?php echo $profil[3]; ?>" name="pseudo" readonly="readonly"/>					<!--lien de modification du mail-->					<a href='index.php?page=profil&action=3'>Changement de l'adresse mail</a>				<?php								mysql_free_result($req);			?>			</div>		</div>	<?php}?>