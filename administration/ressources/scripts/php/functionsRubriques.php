<?php/*Fait la liste des rubriques*/function listeRubrique(){	echo "<select name='rubrique'>";	echo "<option value='null'>Aucune</option>";	$req2 = mysql_query("SELECT * FROM RUBRIQUE WHERE `id_mere` is null;");	while($rubrique=mysql_fetch_array($req2))	{		echo "<option value='".$rubrique[0]."'>".$rubrique[2]."</option>";		getChildRubrique($rubrique[0],0);	}	echo "</select>";}/*Faire une liste des rubriques filles*/function getChildRubrique($idRubrique,$niveau) {	$req = mysql_query("SELECT * FROM RUBRIQUE WHERE id_mere=".$idRubrique);	$niveau++;	while ($rubrique=mysql_fetch_array($req)) {		if($rubrique[0]!=null){			echo "<option value='".$rubrique[0]."'>";			for($i=0;$i<$niveau;$i++){				echo "----";			}			echo ">";			echo $rubrique[2]."</option>";			getChildRubrique($rubrique[0],$niveau);		}	}}/*Vérifie l'existence d'une rubrique*/function rubriqueExistante($id) {	$req = mysql_query("SELECT * FROM RUBRIQUE WHERE id_rubrique=".$id);	$rubrique=mysql_fetch_array($req);	if ($rubrique[0] == null) {		$toReturn=false;	} else {		$toReturn=true;	}	return $toReturn;}/*Fait la liste des rubriques + select*/function listeRubriqueSelected($id_rubrique_mere,$id_rubrique){	echo "<select name='rubrique'>";	if ($id_rubrique_mere==null) {		echo "<option value='null' selected='selected'>Aucune</option>";	} else {		echo "<option value='null'>Aucune</option>";	}	$req2 = mysql_query("SELECT * FROM RUBRIQUE WHERE `id_mere` is null;");	while($rubrique=mysql_fetch_array($req2))	{		if ($rubrique[0]!=$id_rubrique) {			if ($rubrique[0]==$id_rubrique_mere) {				echo "<option value='".$rubrique[0]."' selected='selected'>".$rubrique[2]."</option>";			} else {				echo "<option value='".$rubrique[0]."'>".$rubrique[2]."</option>";			}			getChildRubriqueSelected($rubrique[0],0,$id_rubrique_mere,$id_rubrique);		}	}	mysql_free_result($req2);	echo "</select>";}/*Faire une liste des rubriques filles + select*/function getChildRubriqueSelected($idRubrique,$niveau,$id_rubrique_mere,$id_rubrique) {	$req = mysql_query("SELECT * FROM RUBRIQUE WHERE id_mere=".$idRubrique);	$niveau++;	while ($rubrique=mysql_fetch_array($req)) {		if($rubrique[0]!=null){			if ($rubrique[0]!=$id_rubrique) {				if ($rubrique[0]==$id_rubrique_mere) {					echo "<option value='".$rubrique[0]."' selected='selected'>";				} else {					echo "<option value='".$rubrique[0]."'>";				}				for($i=0;$i<$niveau;$i++){					echo "----";				}				echo ">";				echo $rubrique[2]."</option>";				getChildRubriqueSelected($rubrique[0],$niveau,$id_rubrique_mere,$id_rubrique);			}		}	}	mysql_free_result($req);}/*Fonction qui permet l'affichage des rubriques de manière ordonnée*/function affichageRubriques($idMere,$niveau) {	if ($idMere==null) {		$req = mysql_query("SELECT * FROM RUBRIQUE WHERE id_mere is null");	} else {		$req = mysql_query("SELECT * FROM RUBRIQUE WHERE id_mere=".$idMere);	}	$niveau++;	while ($rubrique=mysql_fetch_array($req)) {		if($rubrique[0]!=null){			echo "<tr class='article'>";			echo "<td class='article'>".$rubrique[0]."</td>";			echo "<td class='article' style='text-align:left;'>";			for($i=1;$i<$niveau;$i++){				echo "---";			}			echo ">";			echo $rubrique[2];			echo "</td>";			echo "<td class='article'>".$rubrique[3]."</td>";			echo "<td class='article'>";			echo "<a href='index.php?page=rubrique&action=2&idRubrique=".$rubrique[0]."'>Modifier</a> - ";			echo "<a href='index.php?page=rubrique&action=3&idRubrique=".$rubrique[0]."'>Supprimer</a>";			echo "</td>";			echo "</tr>";			affichageRubriques($rubrique[0],$niveau);		}	}	mysql_free_result($req);}/*Permet lors de la suppression d'une rubrique de changer toutes les rubriques mères des rubriques filles en null*/function miseAJourRubriqueFilles($idRubriqueMere) {	$req = mysql_query("SELECT * FROM RUBRIQUE WHERE id_mere=".$idRubriqueMere);	while ($rubrique=mysql_fetch_array($req)) {		$req2="UPDATE rubrique SET id_mere=null WHERE id_rubrique=".$rubrique[0].";";		mysql_query($req2) or die(mysql_error());		mysql_free_result($req2);	}	mysql_free_result($req);}/*fonction qui vérifie, lors de la mise à jour d'une rubrique, si il n'y a pas une boucle dans les rubriques mères 1 ok, 0 boucle*/function verificationBoucleRubrique($idRubrique,$idRubriqueMereNew) {	$toReturn=4;		if($idRubriqueMereNew==null) {		$toReturn=1;	} else if ($idRubriqueMereNew==$idRubrique) {		$toReturn=0;	} else {		$req=mysql_query("SELECT id_mere FROM rubrique WHERE id_rubrique=".$idRubriqueMereNew);		$idRubriqueMereNew2=mysql_fetch_array($req);		$toReturn=verificationBoucleRubrique($idRubrique,$idRubriqueMereNew2[0]);	}		return $toReturn;}?>